<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>默认值 | Cool UI</title>
    <meta name="description" content="UI library for Coollu Frontend Team">
    <link rel="stylesheet" href="/cool-ui/assets/style.ffeb38ca.css">
    <link rel="modulepreload" href="/cool-ui/assets/chunks/AlgoliaSearchBox.4b78811a.js">
    <link rel="modulepreload" href="/cool-ui/assets/app.e1a74f66.js">
    <link rel="modulepreload" href="/cool-ui/assets/guide_faq.md.8a4d66db.lean.js">
    
    <link rel="icon" href="/cool-ui/favicon.ico">
  <meta name="twitter:title" content="默认值 | Cool UI">
  <meta property="og:title" content="默认值 | Cool UI">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><!--[--><div class="theme"><header class="nav-bar" data-v-98f9ad16><div class="sidebar-button" data-v-98f9ad16><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/cool-ui/" aria-label="Cool UI, back to home" data-v-98f9ad16 data-v-510a3d95><img class="logo" src="/cool-ui/logo.png" alt="Logo" data-v-510a3d95> Cool UI</a><div class="flex-grow" data-v-98f9ad16></div><div class="nav" data-v-98f9ad16><nav class="nav-links" data-v-98f9ad16 data-v-3e8bb03e><!--[--><div class="item" data-v-3e8bb03e><div class="nav-link" data-v-3e8bb03e data-v-f5a4c54c><a class="item active" href="/cool-ui/guide/" data-v-f5a4c54c>开始使用 <!----></a></div></div><div class="item" data-v-3e8bb03e><div class="nav-link" data-v-3e8bb03e data-v-f5a4c54c><a class="item" href="/cool-ui/components/index/" data-v-f5a4c54c>组件 <!----></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--[--><div class="algolia-search-box" id="docsearch"></div><!--]--><!--]--></header><aside class="sidebar" data-v-34329fec><nav class="nav-links nav" data-v-34329fec data-v-3e8bb03e><!--[--><div class="item" data-v-3e8bb03e><div class="nav-link" data-v-3e8bb03e data-v-f5a4c54c><a class="item active" href="/cool-ui/guide/" data-v-f5a4c54c>开始使用 <!----></a></div></div><div class="item" data-v-3e8bb03e><div class="nav-link" data-v-3e8bb03e data-v-f5a4c54c><a class="item" href="/cool-ui/components/index/" data-v-f5a4c54c>组件 <!----></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-34329fec><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="/cool-ui/guide/">快速上手</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/cool-ui/guide/intro/">培训文档</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/cool-ui/guide/faq">FAQ</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#默认值">默认值</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#表单回写">表单回写</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#表单之外">表单之外...</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#fixedform">fixedForm</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#beforesearch">beforeSearch</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#表单提交">表单提交</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#自定义渲染">自定义渲染</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#渲染的范围">渲染的范围</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#渲染的内容">渲染的内容</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#怎么取表单对象？">怎么取表单对象？</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-7b1d4fe4><div class="container" data-v-7b1d4fe4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7b1d4fe4><div><p>虽然之前对业务框架的常用组件做了一些介绍，也在实践中与大家沟通过组件的使用方法，但还没有体系化地介绍常见的使用场景，这样就难免会出现一些误用，也对后期的维护工作带来了不少困难。</p><h2 id="默认值" tabindex="-1">默认值 <a class="header-anchor" href="#默认值" aria-hidden="true">#</a></h2><p>默认值就是一个很简单的值，它不能依赖<code>formModel</code>相关的值。</p><div class="language-javascript line-numbers-mode"><pre><code><span class="token comment">// 简单值</span>
<span class="token punctuation">{</span>
  <span class="token literal-property property">defaultValue</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>

<span class="token comment">// 来源于一个其他的变量，可以是普通变量，也可以是 ref 变量。</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">{</span>
  <span class="token literal-property property">defaultValue</span><span class="token operator">:</span> a
<span class="token punctuation">}</span>
<span class="token comment">// 或者</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">{</span>
  <span class="token literal-property property">defaultValue</span><span class="token operator">:</span> a<span class="token punctuation">.</span>value
<span class="token punctuation">}</span>

<span class="token comment">// 不可以依赖formModel相关的值</span>
<span class="token punctuation">{</span>
  <span class="token literal-property property">defaultValue</span><span class="token operator">:</span> proFormRef<span class="token punctuation">.</span>value<span class="token punctuation">.</span>formModel<span class="token punctuation">.</span>b
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>总之，就是简单点，别搞花里胡哨的。</p><p>这个默认值也将作为<code>dataIndex</code>所关联的字段的初始值。</p><h2 id="表单回写" tabindex="-1">表单回写 <a class="header-anchor" href="#表单回写" aria-hidden="true">#</a></h2><p>表单一旦初始化完毕后，它可以自行运转，不需要人为干预。</p><p>但是有时候，我们会在一些操作后，希望改变某个表单控件的值，这个时候，需要用到 <code>writeBackForm</code> 来控制，不要尝试用其他自己想出来的方法去更新表单，不一定产生合理的效果。</p><div class="language-javascript line-numbers-mode"><pre><code><span class="token comment">// 可以实现效果，但不是很建议</span>
proFormRef<span class="token punctuation">.</span>value<span class="token punctuation">.</span>formModel<span class="token punctuation">.</span>someField <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>writeBackForm</code> 可以一开始就有值，也可以在异步后得到值。可以是<code>ref</code>，也可以是<code>reactive</code>。</p><div class="language-javascript line-numbers-mode"><pre><code><span class="token comment">// 使用 ref</span>
<span class="token keyword">const</span> writeBackForm <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 异步后整体赋值</span>
writeBackForm<span class="token punctuation">.</span>value <span class="token operator">=</span> res<span class="token punctuation">.</span>result

<span class="token comment">// 使用 reactive</span>
<span class="token keyword">const</span> writeBackForm <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 异步后更新</span>
<span class="token comment">// 只更新一个字段</span>
writeBackForm<span class="token punctuation">.</span>a <span class="token operator">=</span> res<span class="token punctuation">.</span>result<span class="token punctuation">.</span>a
<span class="token comment">// 批量更新</span>
Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>writeBackForm<span class="token punctuation">,</span> res<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>通过 <code>writeBackForm</code> 回写表单，能保证正确地处理一些特殊值，比如范围值。</p><p>对于日期范围，我们从 detail 接口拿到的字段可能是 <code>startTime</code>, <code>endTime</code>，而实际上 <code>daterange</code> 组件需要的是一个数组值，可理解为<code>[startTime, endTime]</code>。</p><p>借助 <code>writeBackForm</code>，我们不需要特意处理范围数据，因为组件内部可以通过<code>transformPropsForRange</code>自动检测和更新数据，保证数据和 UI 的一致性。</p><blockquote><p>你还可以通过<code>setField(field, value)</code>或者<code>setFields(model)</code>进行单一或者批量的表单更新，但是它不会特意去处理特殊类型的表单项，比如前面提到的日期范围。</p></blockquote><h2 id="表单之外" tabindex="-1">表单之外... <a class="header-anchor" href="#表单之外" aria-hidden="true">#</a></h2><p>实际业务中，除了表单 UI 上体现的字段，还有一些字段我们也需要处理，最后传给后端。</p><p>对于这些，我们分两个视角来看。</p><ol><li>固定不变，雷打不动的，见<code>fixedForm</code>。</li><li>可能有逻辑，随逻辑变化的，见<code>beforeSearch</code>。</li></ol><h3 id="fixedform" tabindex="-1">fixedForm <a class="header-anchor" href="#fixedform" aria-hidden="true">#</a></h3><p>对于一些确定下来的参数，并且又<strong>不需要展示在表单上</strong>的，我们可以通过 <code>fixedForm</code>指定。</p><p><code>fixedForm</code>一定是简单的，它就像默认值一般，是可以直接确定下来的。如果你写的 <code>fixedForm</code>很复杂，有很多依赖，那你可能要思考一下了。</p><p>比如后端固定要求，<code>type</code>传 5，<code>xxx</code>传 6。不用想了，放在<code>fixedForm</code>很合适。</p><h3 id="beforesearch" tabindex="-1">beforeSearch <a class="header-anchor" href="#beforesearch" aria-hidden="true">#</a></h3><p>对于一些存在逻辑关系的数据，我们需要用到<code>beforeSearch</code>来处理，最后返回一个完整的对象，交由<code>page</code>接口使用。</p><p>比如行政区域组件，组件绑定的值是一个数组，然而后端可能是需要<code>provinceId</code>，<code>cityId</code>之类的字段。这个时候放在 <code>beforeSearch</code>是最合适的。</p><div class="language-javascript line-numbers-mode"><pre><code><span class="token keyword">const</span> <span class="token function-variable function">beforeSearch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">formModel</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>formModel<span class="token punctuation">,</span>
    <span class="token literal-property property">provinceId</span><span class="token operator">:</span> formModel<span class="token punctuation">.</span>cantonIds<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">cityId</span><span class="token operator">:</span> formModel<span class="token punctuation">.</span>cantonIds<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>很多人会习惯，在<code>onChange</code>马上把数据处理好。实际上，<code>onChange</code>可能会发生很多次，是不是每次<code>onChange</code>后，你都需要得到处理完后的数据呢？大部分情况下，不需要。</p><p>你需要这些处理完的数据的时机，往往都是在提交表单，或者提交查询条件前。所以，只需要在提交之前通过<code>beforeSearch</code>处理即可。</p><p>提前处理数据还会让你的代码定义很多不必要的变量，维护起来非常麻烦。</p><p>总之，让表单自己运转吧，不要去干涉它。你想要结果的时候，再去问它要。</p><h2 id="表单提交" tabindex="-1">表单提交 <a class="header-anchor" href="#表单提交" aria-hidden="true">#</a></h2><p>正如表格场景的<code>beforeSearch</code>所述，表单<code>ProForm</code>也可能在提交前需要处理数据，这个可以通在<code>onSubmit</code>中处理，算是比较常见的。</p><div class="language-javascript line-numbers-mode"><pre><code><span class="token keyword">const</span> <span class="token function-variable function">onSubmit</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">formModel</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
  	<span class="token operator">...</span>formModel<span class="token punctuation">,</span>
    <span class="token literal-property property">otherField</span><span class="token operator">:</span> formModel<span class="token punctuation">.</span>a <span class="token operator">+</span> formModel<span class="token punctuation">.</span>b
  <span class="token punctuation">}</span>
  <span class="token keyword">await</span> xxxService<span class="token punctuation">.</span><span class="token function">yyyMethod</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="自定义渲染" tabindex="-1">自定义渲染 <a class="header-anchor" href="#自定义渲染" aria-hidden="true">#</a></h2><h3 id="渲染的范围" tabindex="-1">渲染的范围 <a class="header-anchor" href="#渲染的范围" aria-hidden="true">#</a></h3><p>首先，使用<code>customRenderFormItem</code>可以自定义渲染某个表单项，配合<code>renderFormItemLevel</code>可以实现不同颗粒度的渲染。 <code>renderFormItemLevel</code>有两个备选值，分别是<code>formItem</code>和<code>widget</code>，默认值是<code>widget</code>。两者的渲染范围不同，具体理解见下面图示。</p><p><img src="/cool-ui/imgs/faq1.png" alt=""></p><p><img src="/cool-ui/imgs/faq2.png" alt=""></p><h3 id="渲染的内容" tabindex="-1">渲染的内容 <a class="header-anchor" href="#渲染的内容" aria-hidden="true">#</a></h3><p>自定义渲染的意思就是不限制你要画什么组件，按钮，输入框，div，随你便。</p><p>但是如果你要绘制与表单数据有关的东西，比如由两个输入框组成的一个范围输入。从数据层面看，实际上它应该是<code>formModel</code>的一部分，只不过是你自己自定义渲染的，所以它的输入（修改）依然应该反馈到<code>formModel</code>上，那么怎么做呢？</p><p>有人可能会想到自己定义两个 ref ，配合 onChange 存一下这两个输入框的值。最后提交表单的时候再把这两个值传过去。</p><p>方式没有问题，但不够优雅。实际上，组件设计已经考虑了这个问题，我们可以通过<code>customRenderFormItem</code>拿到<code>formModel</code>对象，对<code>formModel</code>直接进行操作。我这里直接拿示例组件说一下，一个输入框和两个输入框本质上没有区别。同理，下拉框，其他的都是一个道理，理论上不必定义额外的变量来临时存储（很复杂的除外）。</p><p><img src="/cool-ui/imgs/faq3.png" alt=""></p><p>这种做法有点类似于 React 的受控组件/非受控组件。受控的意思是框架内部已经完成了数据逻辑（绑定值和更新值）的流转。非受控的意思是你放弃了框架内部的逻辑，准备自己动手接管，这个时候你就要自行完成绑定值和更新值的操作。</p><p>或者说跟驾车也类似，自定义渲染的默认行为相当于司机已经松开了方向盘，如果你不接管，车开到哪里就不好说了（也就是：这个数据和表单不一定是正确的），所以你必须接管！</p><h2 id="怎么取表单对象？" tabindex="-1">怎么取表单对象？ <a class="header-anchor" href="#怎么取表单对象？" aria-hidden="true">#</a></h2></div></div><footer class="page-footer" data-v-7b1d4fe4 data-v-04c668bc><div class="edit" data-v-04c668bc><div class="edit-link" data-v-04c668bc data-v-6bd76a75><!----></div></div><div class="updated" data-v-04c668bc><!----></div></footer><div class="next-and-prev-link" data-v-7b1d4fe4 data-v-37c0523f><div class="container" data-v-37c0523f><div class="prev" data-v-37c0523f><a class="link" href="/cool-ui/guide/intro/" data-v-37c0523f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-37c0523f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-37c0523f>培训文档</span></a></div><div class="next" data-v-37c0523f><!----></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--><!--]--><!--]--><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"components_avatar_index.md\":\"c5e59711\",\"components_blank-layout_index.md\":\"d0de47e3\",\"components_button_index.md\":\"1606cc65\",\"components_canton-cascader_index.md\":\"1d2d5217\",\"components_index_index.md\":\"05c14381\",\"guide_faq.md\":\"8a4d66db\",\"guide_index.md\":\"b0f30180\",\"guide_intro_index.md\":\"d07d470e\",\"index.md\":\"b92ed2f2\"}")</script>
    <script type="module" async src="/cool-ui/assets/app.e1a74f66.js"></script>
    
  </body>
</html>